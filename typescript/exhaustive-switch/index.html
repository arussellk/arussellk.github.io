<!doctype html><html lang=en><head><meta charset=utf-8><title>Exhaustive Switch</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/images/favicon-32.png sizes=32x32><link rel=apple-touch-icon href=/images/favicon-180.png sizes=180x180><link rel=stylesheet href=/css/main.css></head><body><div class=main><p><a href=/>home</a></p><h1>Exhaustive Switch</h1><p>Sometimes it is useful to have a compile-time check to make sure that all cases of a union are
represented in code.</p><p>If the code in question is at a function boundary with a return type, you can get a compile-time
check, but the error message is rather unclear.
We can do better than this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#cf222e>type</span> <span style=color:#1f2328>Foo</span> <span style=color:#0550ae>=</span> <span style=color:#0a3069>&#39;a&#39;</span> <span style=color:#0550ae>|</span> <span style=color:#0a3069>&#39;b&#39;</span> <span style=color:#0550ae>|</span> <span style=color:#0a3069>&#39;c&#39;</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>isSpecial</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>foo</span>: <span style=color:#cf222e>Foo</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>boolean</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>                           <span style=color:#57606a>// ~~~~~~~ Function lacks ending return statement and return type does not include &#39;undefined&#39;.
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>    <span style=color:#cf222e>switch</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>foo</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>case</span> <span style=color:#0a3069>&#39;a&#39;</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;got a&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>return</span> <span style=color:#cf222e>true</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>case</span> <span style=color:#0a3069>&#39;b&#39;</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;got b&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>return</span> <span style=color:#cf222e>false</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span></code></pre></div><p>If the code in question does not return a value, you will not get a compile-time error.
This is bad because a future developer can unintentionally miss that they should modify this code
when adding a new <code>Foo</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#cf222e>type</span> <span style=color:#1f2328>Foo</span> <span style=color:#0550ae>=</span> <span style=color:#0a3069>&#39;a&#39;</span> <span style=color:#0550ae>|</span> <span style=color:#0a3069>&#39;b&#39;</span> <span style=color:#0550ae>|</span> <span style=color:#0a3069>&#39;c&#39;</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>isSpecial</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>foo</span>: <span style=color:#cf222e>Foo</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>switch</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>foo</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>case</span> <span style=color:#0a3069>&#39;a&#39;</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;got a&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>return</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>case</span> <span style=color:#0a3069>&#39;b&#39;</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;got b&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>return</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span></code></pre></div><p>To create a compile-time error so that future developers are made aware of your code,
you can use the <code>never</code> type or a string literal.
I prefer the string literal version because the error message from the compiler is more clear.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#cf222e>type</span> <span style=color:#1f2328>Foo</span> <span style=color:#0550ae>=</span> <span style=color:#0a3069>&#39;a&#39;</span> <span style=color:#0550ae>|</span> <span style=color:#0a3069>&#39;b&#39;</span> <span style=color:#0550ae>|</span> <span style=color:#0a3069>&#39;c&#39;</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>const</span> <span style=color:#1f2328>isSpecial</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>foo</span>: <span style=color:#cf222e>Foo</span><span style=color:#1f2328>)</span><span style=color:#0550ae>:</span> <span style=color:#cf222e>void</span> <span style=color:#0550ae>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>switch</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>foo</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>case</span> <span style=color:#0a3069>&#39;a&#39;</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;got a&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>return</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>case</span> <span style=color:#0a3069>&#39;b&#39;</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;got b&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>return</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>default</span><span style=color:#0550ae>:</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>const</span> <span style=color:#1f2328>exhaustiveCheckNever</span>: <span style=color:#cf222e>never</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>foo</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>            <span style=color:#57606a>//    ~~~~~~~~~~~~~~~~~~~~ Type &#39;string&#39; is not assignable to type &#39;never&#39;.
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>            <span style=color:#cf222e>const</span> <span style=color:#1f2328>exhaustiveCheckString</span><span style=color:#0550ae>:</span> <span style=color:#0a3069>&#39;exhaustiveCheckString&#39;</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>foo</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>            <span style=color:#57606a>//    ~~~~~~~~~~~~~~~~~~~~ Type &#39;&#34;c&#34;&#39; is not assignable to type &#39;&#34;exhaustiveCheckString&#34;&#39;.
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>throw</span> <span style=color:#6639ba>Error</span><span style=color:#1f2328>(</span><span style=color:#0a3069>`unhandled Foo </span><span style=color:#0a3069>${</span><span style=color:#1f2328>exhaustiveCheckNever</span><span style=color:#0a3069>}</span><span style=color:#0a3069> </span><span style=color:#0a3069>${</span><span style=color:#1f2328>exhaustiveCheckString</span><span style=color:#0a3069>}</span><span style=color:#0a3069>`</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>};</span>
</span></span></code></pre></div></div></body></html>