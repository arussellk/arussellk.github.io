<!doctype html><html lang=en><head><meta charset=utf-8><title>Exhaustive Switch</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/images/favicon-32.png sizes=32x32><link rel=apple-touch-icon href=/images/favicon-180.png sizes=180x180><link rel=stylesheet href=/css/main.css></head><body><div class=main><p><a href=/>home</a></p><h1>Exhaustive Switch</h1><p>Sometimes it is useful to have a compile-time check to make sure that all cases of a union are
represented in code.</p><p>If the code in question is at a function boundary with a return type, you can get a compile-time
check, but the error message is rather unclear.
We can do better than this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#000;font-weight:700>type</span> Foo <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;a&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#d14>&#39;b&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#d14>&#39;c&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>const</span> isSpecial <span style=color:#000;font-weight:700>=</span> (foo: <span style=color:#458;font-weight:700>Foo</span>)<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>boolean</span> <span style=color:#000;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>                           <span style=color:#998;font-style:italic>// ~~~~~~~ Function lacks ending return statement and return type does not include &#39;undefined&#39;.
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>    <span style=color:#000;font-weight:700>switch</span> (foo) {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>case</span> <span style=color:#d14>&#39;a&#39;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            console.log(<span style=color:#d14>&#39;got a&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>case</span> <span style=color:#d14>&#39;b&#39;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            console.log(<span style=color:#d14>&#39;got b&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>If the code in question does not return a value, you will not get a compile-time error.
This is bad because a future developer can unintentionally miss that they should modify this code
when adding a new <code>Foo</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#000;font-weight:700>type</span> Foo <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;a&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#d14>&#39;b&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#d14>&#39;c&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>const</span> isSpecial <span style=color:#000;font-weight:700>=</span> (foo: <span style=color:#458;font-weight:700>Foo</span>)<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>void</span> <span style=color:#000;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>switch</span> (foo) {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>case</span> <span style=color:#d14>&#39;a&#39;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            console.log(<span style=color:#d14>&#39;got a&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>return</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>case</span> <span style=color:#d14>&#39;b&#39;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            console.log(<span style=color:#d14>&#39;got b&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>To create a compile-time error so that future developers are made aware of your code,
you can use the <code>never</code> type or a string literal.
I prefer the string literal version because the error message from the compiler is more clear.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#000;font-weight:700>type</span> Foo <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;a&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#d14>&#39;b&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#d14>&#39;c&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>const</span> isSpecial <span style=color:#000;font-weight:700>=</span> (foo: <span style=color:#458;font-weight:700>Foo</span>)<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>void</span> <span style=color:#000;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>switch</span> (foo) {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>case</span> <span style=color:#d14>&#39;a&#39;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            console.log(<span style=color:#d14>&#39;got a&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>return</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>case</span> <span style=color:#d14>&#39;b&#39;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            console.log(<span style=color:#d14>&#39;got b&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>return</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>const</span> exhaustiveCheckNever: <span style=color:#458;font-weight:700>never</span> <span style=color:#000;font-weight:700>=</span> foo;
</span></span><span style=display:flex><span>            <span style=color:#998;font-style:italic>//    ~~~~~~~~~~~~~~~~~~~~ Type &#39;string&#39; is not assignable to type &#39;never&#39;.
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            <span style=color:#000;font-weight:700>const</span> exhaustiveCheckString<span style=color:#000;font-weight:700>:</span> <span style=color:#d14>&#39;exhaustiveCheckString&#39;</span> <span style=color:#000;font-weight:700>=</span> foo;
</span></span><span style=display:flex><span>            <span style=color:#998;font-style:italic>//    ~~~~~~~~~~~~~~~~~~~~ Type &#39;&#34;c&#34;&#39; is not assignable to type &#39;&#34;exhaustiveCheckString&#34;&#39;.
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>throw</span> <span style=color:#0086b3>Error</span>(<span style=color:#d14>`unhandled Foo </span><span style=color:#d14>${</span>exhaustiveCheckNever<span style=color:#d14>}</span><span style=color:#d14> </span><span style=color:#d14>${</span>exhaustiveCheckString<span style=color:#d14>}</span><span style=color:#d14>`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div></div></body></html>